/* 
 * GD Rating Slider
 * v2.0
 * 2018 dev4Press.com
 * 
 * This script is based on the rangeslider.js script, and it borrows
 * several functions from it related to handle dragging functionality.
 * 
 * https://github.com/andreruffert/rangeslider.js
 */
;(function($,f,g,h){"use strict";Number.isNaN=Number.isNaN||function(a){return typeof a==='number'&&a!==a};function tryParseFloat(a,b){var c=parseFloat(a);return Number.isNaN(c)?b:c}function ucfirst(a){return a.charAt(0).toUpperCase()+a.substr(1)}function delay(a,b){var c=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)}function debounce(b,c){c=c||100;return function(){if(!b.debouncing){var a=Array.prototype.slice.apply(arguments);b.lastReturnVal=b.apply(f,a);b.debouncing=true}clearTimeout(b.debounceTimeout);b.debounceTimeout=setTimeout(function(){b.debouncing=false},c);return b.lastReturnVal}}function isHidden(a){return(a&&(a.offsetWidth===0||a.offsetHeight===0||a.open===false))}function getHiddenParentNodes(a){var b=[],node=a.parentNode;while(isHidden(node)){b.push(node);node=node.parentNode}return b}function getDimension(b,c){var d=getHiddenParentNodes(b),hiddenParentNodesLength=d.length,inlineStyle=[],dimension=b[c];function toggleOpenProperty(a){if(typeof a.open!=='undefined'){a.open=(a.open)?false:true}}if(hiddenParentNodesLength){for(var i=0;i<hiddenParentNodesLength;i++){inlineStyle[i]=d[i].style.cssText;if(d[i].style.setProperty){d[i].style.setProperty('display','block','important')}else{d[i].style.cssText+=';display: block !important'}d[i].style.height='0';d[i].style.overflow='hidden';d[i].style.visibility='hidden';toggleOpenProperty(d[i])}dimension=b[c];for(var j=0;j<hiddenParentNodesLength;j++){d[j].style.cssText=inlineStyle[j];toggleOpenProperty(d[j])}}return dimension}var k="gdRatingSlider",pluginIdentifier=0,defaults={classMain:"gd-rating-slider",classModHasRating:"__with-rating",classModHasRaterLabel:"__with-rater-label",classModHasMinMax:"__with-minmax",classModHasGrid:"__with-grid",classModHasLabel:"__with-label",classModHideHandle:"__without-handle",classModIsRTL:"__is-rtl",classAtMin:"__value-is-min",classAtMax:"__value-is-max",classPrefix:"gdrsld",classSuffixSlider:"__slider",classSuffixRater:"__rater",classSuffixRating:"__rating",classSuffixMinMax:"__minmax",classSuffixMin:"__min",classSuffixMax:"__max",classSuffixInner:"__inner",classSuffixHandle:"__handle",classSuffixLabel:"__label",classSuffixLabelEmpty:"__label_empty",classSuffixFill:"__fill",classSuffixGrid:"__grid",classSuffixGridLines:"__grid_lines",classSuffixGridNumbers:"__grid_numbers",classSuffixClearfix:"__clearfix",classSuffixDisabled:"__disabled",classSuffixActive:"__active",classGridNumber:"__grid-number",classGridLineUnit:"__grid-unit",classGridLineSubUnit:"__grid-subunit",class:"",theme:"default",rating:0,hideHandle:false,showLabel:true,showMinMax:true,showGrid:true,showRating:true,showRaterLabel:false,gridUnits:5,gridSubUnits:4,width:"auto",minWidth:"auto",maxWidth:"100%",responsive:true,responsiveCutoff:560,onInit:null,onChange:null,onSlide:null};function GDRS(a,b){this.el=a;this.$el=$(a);this.$elf=this.$el[0];this.id='js-'+k+'-'+(pluginIdentifier++);this._name=k;this._defaults=defaults;this._metadata=this.$el.data();this.settings=$.extend({},defaults,b,this._metadata);this.dimension='width';this.direction='left';this.coordinate='x';this.init();if(this.settings.onInit&&typeof this.settings.onInit==='function'){this.settings.onInit(this.id)}}$.extend(GDRS.prototype,{init:function(){this.startEvent=['mousedown','touchstart','pointerdown'].join('.'+this.id+' ')+'.'+this.id;this.moveEvent=['mousemove','touchmove','pointermove'].join('.'+this.id+' ')+'.'+this.id;this.endEvent=['mouseup','touchend','pointerup'].join('.'+this.id+' ')+'.'+this.id;this.resizeEvent=['load','resize','orientationchange'].join('.'+this.id+' ')+'.'+this.id;this.calc={};this.input={min:tryParseFloat(this.$elf.getAttribute('min'),0),max:tryParseFloat(this.$elf.getAttribute('max'),100),step:tryParseFloat(this.$elf.getAttribute('step'),1)};this.input.value=tryParseFloat(this.$elf.value,this.input.min);this.input.range=this.input.max-this.input.min;this.target="#"+this.id+" ."+this.cls("Inner")+":not("+this.cls("Disabled")+")";this.hide();this.render();this.resize(false);this.handleDown=$.proxy(this.handleDown,this);this.handleMove=$.proxy(this.handleMove,this);this.handleEnd=$.proxy(this.handleEnd,this);var c=this;$(f).on(this.resizeEvent,debounce(function(){delay(function(){c.resize(false)},200)},20));this.$el.on('change.'+this.id,function(e,a){if(a&&a.origin===c.id){return}var b=e.target.value,pos=c.positionFromValue(b);c.setPosition(pos)});$(g).on(this.startEvent,this.target,this.handleDown)},disable:function(){this.$el.prop("disabled",true);this.$inner.addClass(this.cls("Disabled"))},enable:function(){this.$el.prop("disabled",false);this.$inner.removeClass(this.cls("Disabled"))},update:function(){this.resize(false)},handleDown:function(e){e.preventDefault();if(this.$inner.hasClass(this.cls("Disabled"))){return}$(g).on(this.moveEvent,this.target,this.handleMove);$(g).on(this.endEvent,this.target,this.handleEnd);this.$inner.addClass(this.cls("Active"));if((' '+e.target.className+' ').replace(/[\n\t]/g,' ').indexOf(this.cls("Handle"))>-1){return}var a=this.relativePosition(e),rangePos=this.$inner[0].getBoundingClientRect()[this.direction],handlePos=this.positionFromNode(this.$handle[0])-rangePos,setPos=a-this.calc.grab;if(a>=handlePos&&a<handlePos+this.handle){this.calc.grab=a-handlePos}this.setPosition(setPos)},handleMove:function(e){e.preventDefault();var a=this.relativePosition(e),setPos=a-this.calc.grab;this.setPosition(setPos)},handleEnd:function(e){e.preventDefault();$(g).off(this.moveEvent,this.target,this.handleMove);$(g).off(this.endEvent,this.target,this.handleEnd);this.$inner.removeClass(this.cls("Active"));this.$el.trigger('change',{origin:this.id});if(this.settings.onChange&&typeof this.settings.onChange==='function'){this.settings.onChange(this.input.value,this.id)}},render:function(){var a=[this.settings.classMain,this.settings.classPrefix+'-theme__'+this.settings.theme],sty=['width:'+this.settings.width,'min-width:'+this.settings.minWidth,'max-width:'+this.settings.maxWidth];if(this.settings.class!==''){a.push(this.settings.class)}if(this.show("Rating")){a.push(this.settings.classModHasRating)}if(this.show("MinMax")){a.push(this.settings.classModHasMinMax)}if(this.show("Grid")){a.push(this.settings.classModHasGrid)}if(this.show("Label")){a.push(this.settings.classModHasLabel)}if(this.show("RaterLabel")){a.push(this.settings.classModHasRaterLabel)}if(this.rtl()){a.push(this.settings.classModIsRTL)}if(this.settings.hideHandle){a.push(this.settings.classModHideHandle)}this.$wrapper=$('<div style="'+sty.join(";")+'" class="'+a.join(" ")+'" id="'+this.id+'" />').insertAfter(this.$el);this.$slider=$('<div class="'+this.cls("Slider")+'" />');this.$inner=$('<div class="'+this.cls("Inner")+'" />');this.$handle=$('<div class="'+this.cls("Handle")+'" />');this.$label=$('<div class="'+this.cls("Label")+'">'+this.input.value+'</div>');this.$fill=$('<div class="'+this.cls("Fill")+'" />');this.$rater=$('<div class="'+this.cls("Rater")+'"><span>'+this.settings.rating+'</span></div>');this.$inner.prepend(this.$rater,this.$fill,this.$handle);this.$wrapper.prepend(this.$slider);if(this.show("Label")){this.$inner.prepend(this.$label)}if(this.show("Rating")){this.$wrapper.prepend('<div class="'+this.cls("Rating")+'">'+this.settings.rating+'</div>')}if(this.show("MinMax")){this.$slider.prepend('<div class="'+this.cls("MinMax")+'"><span class="'+this.cls("Min")+'">'+this.input.min+'</span><span class="'+this.cls("Max")+'">'+this.input.max+'</span></div>')}else if(this.show("Label")){this.$slider.prepend('<div class="'+this.cls("LabelEmpty")+'"></div>')}this.$slider.append(this.$inner);if(this.show("Grid")){this.$grid=$('<div class="'+this.cls("Grid")+'">'+this.grid()+'</div>');this.$slider.append(this.$grid)}},resize:function(a){this.input.value=tryParseFloat(this.$elf.value,this.input.min);this.calc.parent=this.$el.parent().width();this.calc.handle=getDimension(this.$handle[0],'offset'+ucfirst(this.dimension));this.calc.range=getDimension(this.$inner[0],'offset'+ucfirst(this.dimension));this.calc.max=this.calc.range-this.calc.handle;this.calc.grab=this.calc.handle/2;this.calc.position=this.positionFromValue(this.input.value);this.calc.rater=this.positionFromValue(this.settings.rating);this.$rater[0].style[this.dimension]=(this.calc.rater+this.calc.grab)+'px';if(this.settings.responsive&&this.calc.parent>0&&this.settings.responsiveCutoff>0){if(this.calc.parent<=this.settings.responsiveCutoff){if(this.show("Rating")){this.$wrapper.removeClass(this.settings.classModHasRating);this.$wrapper.addClass(this.settings.classModHasRaterLabel)}}else{if(this.show("Rating")){this.$wrapper.addClass(this.settings.classModHasRating);if(!this.show("RaterLabel")){this.$wrapper.removeClass(this.settings.classModHasRaterLabel)}}}}if(this.show("Grid")){this.$grid.css({"width":"calc(100% - "+this.calc.handle+"px)","margin-left":(this.calc.handle/2)+"px"});$("."+this.settings.classGridNumber,this.$wrapper).each(function(){var m=-$(this).outerWidth()/2;$(this).css("margin-left",m+"px")})}if(this.$elf.disabled){this.$inner.addClass(this.cls("Disabled"))}else{this.$inner.removeClass(this.cls("Disabled"))}this.setPosition(this.calc.position,a)},hide:function(){this.$el.css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"}).addClass(this.id)},show:function(a){return this.settings["show"+a]},cls:function(a){return this.settings.classPrefix+this.settings["classSuffix"+a]},rtl:function(){return g.dir==="rtl"},cap:function(a,b,c){if(a<b){return b}if(a>c){return c}return a},grid:function(){var a=[],numbers=[],i,j,val,pos,sub,valBig=Math.ceil(this.input.range/this.settings.gridUnits),posBig=100/this.settings.gridUnits,posSmall=100/(this.settings.gridUnits*this.settings.gridSubUnits);for(i=0;i<=this.settings.gridUnits;i++){val=this.input.min+i*valBig;pos=i*posBig;numbers.push('<span class="'+this.settings.classGridNumber+'" style="left: '+pos+'%">'+val+'</span>');a.push('<span class="'+this.settings.classGridLineUnit+'" style="left: '+pos+'%"></span>');if(i<this.settings.gridUnits){for(j=1;j<this.settings.gridSubUnits;j++){sub=((i*this.settings.gridSubUnits)+j)*posSmall;a.push('<span class="'+this.settings.classGridLineSubUnit+'" style="left: '+sub+'%"></span>')}}}return'<div class="'+this.cls("GridLines")+'">'+a.join("")+'</div><div class="'+this.cls("GridNumbers")+'">'+numbers.join("")+'</div>'},setPosition:function(a,b){var c,newPos;if(b===h){b=true}c=this.valueFromPosition(this.cap(a,0,this.calc.max));newPos=this.positionFromValue(c);if(c===this.input.min){this.$wrapper.addClass(this.settings.classAtMin)}else{this.$wrapper.removeClass(this.settings.classAtMin)}if(c===this.input.max){this.$wrapper.addClass(this.settings.classAtMax)}else{this.$wrapper.removeClass(this.settings.classAtMax)}this.$fill[0].style[this.dimension]=(newPos+this.calc.grab)+'px';this.$handle[0].style[this.direction]=newPos+'px';this.$label[0].style[this.direction]=(newPos+this.calc.grab)+'px';$(this.$label[0]).html(c);var m=-$(this.$label[0]).outerWidth()/2;$(this.$label[0]).css("margin-left",m+"px");this.setValue(c);this.calc.position=newPos;this.input.value=c;if(b&&this.settings.onSlide&&typeof this.settings.onSlide==='function'){this.settings.onSlide(this.input.value,this.id)}},positionFromNode:function(a){var i=0;while(a!==null){i+=a.offsetLeft;a=a.offsetParent}return i},relativePosition:function(e){var a=ucfirst(this.coordinate),rangePos=this.$inner[0].getBoundingClientRect()[this.direction],pageCoordinate=0;if(typeof e.originalEvent['client'+a]!=='undefined'){pageCoordinate=e.originalEvent['client'+a]}else if(e.originalEvent.touches&&e.originalEvent.touches[0]&&typeof e.originalEvent.touches[0]['client'+a]!=='undefined'){pageCoordinate=e.originalEvent.touches[0]['client'+a]}else if(e.currentPoint&&typeof e.currentPoint[this.coordinate]!=='undefined'){pageCoordinate=e.currentPoint[this.coordinate]}return pageCoordinate-rangePos},positionFromValue:function(a){var b=(a-this.input.min)/(this.input.max-this.input.min);return(!Number.isNaN(b))?b*this.calc.max:0},valueFromPosition:function(a){var b=(a)/(this.calc.max||1),value=this.input.step*Math.round(b*(this.input.max-this.input.min)/this.input.step)+this.input.min;return Number((value).toFixed(this.toFixed))},setValue:function(a){if(a===this.input.value&&this.$elf.value!==''){return}this.$el.val(a).trigger('input',{origin:this.id})}});$.fn[k]=function(b,c,d){if(b===h||typeof b==="object"){return this.each(function(){if(!$.data(this,"plugin_"+k)){$.data(this,"plugin_"+k,new GDRS(this,b))}})}else if(typeof b==="string"){if(b==="enable"||b==="disable"||b==="update"){this.each(function(){if($.data(this,"plugin_"+k)){var a=$.data(this,"plugin_"+k);a[b]()}})}}}})(jQuery,window,document);
