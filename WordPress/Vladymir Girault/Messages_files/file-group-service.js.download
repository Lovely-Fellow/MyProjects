define(["./common","angular","lodash"],function(e,t,i){"use strict";e.factory("eoFileGroup",["$q","eoFiles","eoFileAttachment",function(e,o,n){var r=function(e){return this.spaceId=e,this.files=[],this};return r.prototype.hasFiles=function(){return this.files.length>0},r.prototype.hasFile=function(e){var i=!1;return t.forEach(this.files,function(t){e.name===t.fileName&&e.size===t.fileSize&&(i=!0)}),i},r.prototype._attachFiles=function(i){var o=e.defer(),r=[],s=this;return t.forEach(i,function(e){if(s.hasFile(e))console.log("File already attached");else{var t=n.create();t.upload(e,s.spaceId),r.push(t),s.files.push(t)}}),o.resolve(r),o.promise},r.prototype.add=function(e){this.files.push(e)},r.prototype.attach=function(e){return this._attachFiles(e)},r.prototype.remove=function(e){i.remove(this.files,function(t){return t.fileName===e.fileName})},r.prototype.clear=function(){this.files=[]},r.prototype.commit=function(){var i=this,n=[];return this.hasFiles()?(t.forEach(this.files,function(e){e.hasError()||(n.push(e.fileId),e.imageUid&&n.push(e.imageUid))}),0===n.length?(i.clear(),e.when({})):(console.log("[files] Confirming files",n),o.commitFiles(n).then(function(){i.clear()}))):e.when({})},{create:function(e){return new r(e)}}}])});