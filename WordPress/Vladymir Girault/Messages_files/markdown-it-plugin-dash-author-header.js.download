define(["./markdown-it-plugin-dash-helpers"],function(r){"use strict";return function(e){function a(r,e){var a,t,s,o,n,c,h,i,u,p,l,d,f,_,g=r.pos,k=r.posMax,m=!1;if(60!==r.src.charCodeAt(r.pos)||37!==r.src.charCodeAt(r.pos+1))return!1;for(g+=2,s=g;g<k;){if(":"===r.src.charAt(g)){t=g;break}g++}if(!t)return!1;for(g++,c=g;g<k;){if(":"===(_=r.src.charAt(g))||">"===_){n=g;break}g++}if(!n)return!1;if(m=":"===_,g++,m){for(l=g;g<k;){if("|"===r.src.charAt(g)){p=g;break}g++}if(!p)return!1;for(g++,u=g;g<k;){if(">"===r.src.charAt(g)){i=g;break}g++}if(!i)return!1;g++}return o=r.src.slice(s,t),h=r.src.slice(c,n),d=r.src.slice(l,p),a=r.src.slice(u,i),e||(f=r.push("dash_author_header_open","eo-story-header",1),f.attrs=[["user-id",o.replace(/{{/g,"[[").replace(/}}/g,"]]")],["org-id",h.replace(/{{/g,"[[").replace(/}}/g,"]]")]],r.env.roomId&&f.attrs.push(["room-id",r.env.roomId]),m&&f.attrs.push(["integration-story",!0],["photo-url",unescape(d).replace(/{{/g,"[[").replace(/}}/g,"]]")],["full-name",a.replace(/{{/g,"[[").replace(/}}/g,"]]")]),r.push("dash_author_header_close","eo-story-header",-1)),r.pos=g,r.posMax=k,!0}function t(e){n.test(e.src)&&(e.src=e.src.replace(n,function(e){return r.mask(e)}))}function s(e){var a,t,s=!1;for(a=e.length-1;a>=0;a--)t=e[a],"text"===t.type&&s&&(t.content=r.demask(t.content)),"dash_author_header_close"===t.type&&(s=!0),"dash_author_header_open"===t.type&&(s=!1)}function o(r){var e;for(e=r.tokens.length-1;e>=0;e--)"inline"===r.tokens[e].type&&s(r.tokens[e].children)}e.inline.ruler.push("dash_author_header",a);var n=new RegExp("(<%[^|]+\\|)([^>]*?["+r.maskableOperators.join("")+"]+[^>]*)?(>)","gm");e.core.ruler.before("normalize","dash_author_header_mask",t),e.core.ruler.push("dash_author_header_demask",o)}});