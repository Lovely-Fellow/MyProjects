define(["./common","./oauth-service"],function(e){"use strict";e.factory("eoOauthClient",["eoOauth","$http","$q",function(e,t,n){var r,c=function(c,o,u){var a="",i=n.defer();r=0;var s=function(){a=e.getToken();var n;switch(c){case"POST":u.access_token=a,n=t.post(o,u);break;case"GET":o+="?access_token="+a,n=t.get(o)}return n.then(function(e){i.resolve(e)},function(t){var n=t.status,c=t.data;if(401===n&&"invalid_token"===c.error.message)try{if(r>0)return i.reject(t);var o=e.refreshToken();return o.then(function(){s()},function(){i.reject(t)}),o}catch(e){i.reject(t)}else i.reject(t)}).finally(function(){r++}),n};return s(),i.promise};return{get:function(e){return r=0,c("GET",e)},post:function(e,t){return r=0,c("POST",e,t)}}}])});