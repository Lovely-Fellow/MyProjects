define(["./markdown-it-plugin-dash-helpers"],function(e){"use strict";return function(o){function r(e,o){var r,n,t,s,a,i=e.posMax,c=e.pos;if(60!==e.src.charCodeAt(c)||35!==e.src.charCodeAt(c+1))return!1;for(c+=2,n=c;c<i;){if("|"===e.src.charAt(c)){r=c;break}c++}if(!r)return!1;for(c+=1,t=c;c<i;){if(">"===e.src.charAt(c)){s=c;break}c++}if(!s)return!1;var m=e.src.slice(n,r);return o||(a=e.push("dash_room_mention_open","a",1),a.attrs=[["href",""],["eo-room-id",m]],e.pos=t,e.posMax=s,e.md.inline.tokenize(e),e.push("dash_room_mention_close","a",-1)),c+=1,e.pos=c,e.posMax=i,!0}function n(o){a.test(o.src)&&(o.src=o.src.replace(a,function(o){return e.mask(o)}))}function t(o){var r,n,t=!1;for(r=o.length-1;r>=0;r--)n=o[r],"text"===n.type&&t&&(n.content=e.demask(n.content)),"dash_room_mention_close"===n.type&&(t=!0),"dash_room_mention_open"===n.type&&(n.attrSet("eo-room-id",e.demask(n.attrGet("eo-room-id"))),t=!1)}function s(e){var o;for(o=e.tokens.length-1;o>=0;o--)"inline"===e.tokens[o].type&&t(e.tokens[o].children)}o.inline.ruler.push("dash_room_mention",r);var a=new RegExp("(<#[^|]+\\|)([^>]*?["+e.maskableOperators.join("")+"]+[^>]*)?(>)","gm");o.core.ruler.before("normalize","dash_room_mention_mask",n),o.core.ruler.push("dash_room_mention_demask",s)}});