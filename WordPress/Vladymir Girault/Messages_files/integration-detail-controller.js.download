define(["angular"],function(e){"use strict";return["$scope","$state","$location","$window","$modal","$timeout","integrationId","eoRooms","eoDashConfig","eoRoomDialog","eoAuth","eoDashContext","eoPluginsDetailService","newIntegrationFlag","eoFileAttachment","eoFiles","eoGoogleAnalytics","eoAlert",function(t,n,i,o,a,s,r,l,c,g,d,p,u,m,b,f,I,h){t.host=i.host(),t.integration="",t.token="",t.enabled="Disable",t.updateSection={},t.activeTab="settings",t.settingsTabActive=!0,t.instructionsTabActive=!1,t.newIntegrationFlag=m,t.secsToLeaveUpConfirm=5e3,t.saveEnabled=!1,t.setupImageLocation=c.assets.url+c.imagesPath,t.editingDisabled=!0,t.disableEdit=function(){return t.editingDisabled||p.isReadOnlyMode()},t.errorMessageFromBE="",u.getIntegrationById(r).then(function(e){t.webhookURL=c.integrationWebhookBaseURL+e.webhookURL,t.integration=e,t.token=e.sharedSecret,t.updateSection.botName=e.integrationName,t.updateSection.botIcon=e.integrationIconURL,t.selectedRoomId=e.roomId,e.enabled<1&&(t.enabled="Enable"),"ALL"!==e.permissions[0]&&1!==e.permissions[0]||(t.editingDisabled=!1),t.setupTemplate="",u.getApplicationById(e.applicationId).then(function(e){t.setupTemplate=u.getSetupTemplate(e.metadata.setupTemplate),t.isRoomIntegration=e.metadata.is_room_integration,t.application=e,"true"===m?I.ga("Integrations","new integration created",e.appName):I.ga("Integrations","edit integration screen viewed",e.appName)})}),t.refreshToken=function(){u.refreshIntegrationToken(r).then(function(e){e.code?h.inline({type:"danger",template:e.message}):(I.ga("Integrations","refresh integration token",t.application.appName),t.token=e.sharedSecret,t.webhookURL=c.integrationWebhookBaseURL+e.webhookURL)})},t.saveSettings=function(){u.saveNewSettings(r,t.updateSection.botName,t.updateSection.botIcon,t.selectedRoomId).then(function(e){e&&e.code?h.inline({type:"danger",template:e.message}):(I.ga("Integrations","integration edit saved",t.application.appName),t.changeBotSubmit=!0,h.inline({type:"success",template:"Settings saved successfully!"}),t.saveEnabled=!1)})},t.removeIntegration=function(){a.promptBox("Confirm removal","Do you really want to delete this integration?").result.then(function(e){e&&(I.ga("Integrations","integration removed",t.application.appName),u.deleteIntegration(r).then(function(e){e&&e.code?h.inline({type:"danger",template:e.message}):n.go("plugins.existingintegrations",{self:!0})}))})},t.disableIntegration=function(){var e=!1;"Enable"===t.enabled&&(e=!0),u.disableIntegration(r,e).then(function(n){n&&n.code?h.inline({type:"danger",template:n.message}):e?(I.ga("Integrations","integration enabled",t.application.appName),t.enabled="Disable",h.inline({type:"success",template:"Integration enabled"})):(I.ga("Integrations","integration disabled",t.application.appName),t.enabled="Enable",h.inline({type:"warning",template:"Integration disabled"}))})},t.navEntryClicked=function(e){0===e?(t.activeTab="settings",t.settingsTabActive=!0,t.instructionsTabActive=!1):(t.activeTab="instructions",t.settingsTabActive=!1,t.instructionsTabActive=!0)},t.getRoomSearch=function(e){return u.searchForRooms(e)},t.onNewRoomSelect=function(e){t.selectedRoomId=e.room.roomId,t.saveEnabled=!0},t.updateSaveButton=function(){t.updateSection.botName!==t.integration.integrationName||t.updateSection.botIcon!==t.integration.integrationIconURL||t.selectedRoomId!==t.integration.roomId?t.saveEnabled=!0:t.saveEnabled=!1},t.addBuildVersion=function(e){return e?e+"?"+o.dashVersion:void 0},t.hideAlert=function(){t.newIntegrationFlag="false"},t.triggerAttach=function(){o.setTimeout(function(){e.element("#file-upload").trigger("click")},0)},t.attach=function(n){var i={};n.length>0&&(t.updateSection.botIconUploading=!0,i=b.create(),i.upload(n[0],"public").then(function(){i.commit().then(function(){t.updateSection.botIcon=i.previewUrl,t.updateSaveButton()})}).finally(function(){t.updateSection.botIconUploading=!1,e.element("#file-upload").val("")}))},t.openInstruction=function(){a.open({templateUrl:"@templates/plugins/plugins-webhooks/setup-instruction-dialog.html",scope:t,size:"lg"})}}]});