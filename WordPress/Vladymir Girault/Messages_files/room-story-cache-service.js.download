define(["./room","angular","lodash"],function(e,t,n){"use strict";e.factory("eoRoomStoryCache",["$cacheFactory","eoAuth",function(e,r){var o=e("WPstories"),u={},c=new RegExp("^s_"+r.user.userId+"_"+r.user.orgId+"_(.*)$"),s=function(e){return"s_"+r.user.userId+"_"+r.user.orgId+"_"+e},a=function(e){return e.length?e[e.length-1].created:(new Date).getTime()},i={has:function(e){return!!o.get(s(e))},get:function(e){try{var n=t.fromJson(o.get(s(e)));return n.s?n.s:n}catch(e){}},cleanse:function(e){delete e.user},put:function(e,r){r=n.cloneDeep(r),r.map(this.cleanse);var c={t:a(r),s:r},i=s(e);return u[i]||(u[i]=!0),o.put(i,t.toJson(c)),!0},remove:function(e){o.remove(s(e))},purge:function(e){var t;n.each(u,function(n,r){(t=r.match(c))&&e.indexOf(t[1])<0&&(o.remove(r),delete u[r])})}};return function(){return i}()}])});