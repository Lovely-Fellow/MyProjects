define(["lodash"],function(e){"use strict";return["$location","$modal","$scope","eoAuth","rooms","room","eoRoomDialog","$state","eoThriftRoomType","eoUsers","eoDashContext","eventLog",function(n,r,o,t,i,s,u,a,d,c,l,I){if(s.roomType===d.ONE_ON_ONE)return void a.go("rooms.chat",{id:s.roomId});o.currentUserId=t.user.userId,o.currentOrgId=t.user.orgId,s.canInviteHM().then(function(e){if(o.allowInviteHM=e,o.allowInviteHM){var n={event:"impression",location:"dash",sublocation:"help_me_hire",data:[{dash_location:s.isJustInterview()?"interview_room":"workroom"}]};I.log(n)}}),s.isJustInterview()?o.inviteHMPlaceholder="to help you interview and evaluate freelancers.":s.isWorkroom()?o.inviteHMPlaceholder="to communicate with your freelancers on Upwork.":o.inviteHMPlaceholder="",o.invitePeople=function(){if(o.allowInviteHM){var e={event:"click",location:"dash",sublocation:"help_me_hire",data:[{action:"Add a Coworker",dash_location:s.isJustInterview()?"interview_room":"workroom"}]};I.log(e)}u.invite(s,o.allowInviteHM)},o.closeInviteCoworkers=function(){o.allowInviteHM=!1},o.toggleDropdown=function(n,r){n.preventDefault(),n.stopPropagation();var t=e.findIndex(o.users,{userId:r.userId});-1!==t&&(o.users[t].editOptionOpen=!o.users[t].editOptionOpen)};var f=function(){o.users=s.users,o.users=e.map(o.users,function(e){return e.editOptionOpen=!1,e}),c.several(e.map(o.users,"userId"),!0).then(function(n){e.forEach(n,function(n){e.filter(o.users,{userId:n.userId}).forEach(function(e){e.info=n.info})}),c.settleDuplicates(o.users)})},m=o.$watch(function(){return s.users.map(function(e){return e.userId}).join()},f);o.canMakeOwner=function(){return s.isOwner()},o.canKick=function(e){return(e.userId!==o.currentUserId||e.orgId!==o.currentOrgId)&&s.canKick(e)},o.canLeave=function(e){return e.userId===o.currentUserId&&e.orgId===o.currentOrgId&&!s.isOwner(e)&&s.canLeave(e)},o.canEdit=function(e){return(e.userId!==o.currentUserId||e.orgId!==o.currentOrgId)&&s.canEdit(e)},o.leave=function(){l.isReadOnlyMode()||u.leave(s,i,o.currentUserId,o.currentOrgId)},o.resendInvite=function(e){u.resendInvite(s,e.email)},o.kick=function(e){l.isReadOnlyMode()||s.leave(e.userId,e.orgId)},o.makeOwner=function(e){l.isReadOnlyMode()||r.promptBox("Change owner","You won't be owner anymore. ").result.then(function(n){n&&s.makeOwner(e.userId,e.orgId)})},o.makeAdmin=function(e){l.isReadOnlyMode()||s.makeAdmin(e)},o.removeAdmin=function(e){l.isReadOnlyMode()||s.removeAdmin(e.userId,e.orgId)},o.userRole=function(e){return s.isOwner(e)?"owner":s.isAdmin(e)?"admin":"member"},s.getInvites().then(function(e){o.invites=e}),o.$on("$destroy",function(){s.users=e.map(s.users,function(n){return e.omit(n,["editOptionOpen"])}),m()})}]});