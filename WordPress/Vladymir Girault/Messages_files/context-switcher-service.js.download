define(["./common","angular","./cross-communication-service","./auth-service","./context-service"],function(o,e){"use strict";o.controller("wrongCompanyDialogCtrl",["$modalInstance","room","organization",function(o,e,t){this.room=e,this.organization=t,this.changeCompany=function(){o.close(!0)}}]),o.factory("eoContextSwitcher",["$http","$q","eoCrossCommunication","eoAuth","eoDashContext","$window","$state","$modal","$timeout","$stateParams",function(t,r,n,s,i,a,c,m,l){var u={};return u.switchCompanyDialogHandler=function(e,t,s,u){return i.isWidget()?(n.postParent({type:"dash:room:accessError",roomId:s}),r.defer().promise):m.open({templateUrl:o.templatePath+"wrong-company-dialog.html",controller:"wrongCompanyDialogCtrl as ctrl",resolve:{room:function(){return t},organization:function(){return e}}}).result.then(function(){return a.localStorage.removeItem("lastRoom"),i.switchToOrg(c.href(u,{id:s}),e),r.reject([{hideMessage:!0}])}).catch(function(){return console.info("not switching to this rid: "+e.rid+", the taget room is: "+s),l(function(){c.go("rooms.index")}),r.reject([{hideMessage:!0}])})},u.noAccessToRoomDialog=function(o,t,s){if(i.isWidget())return n.postParent({type:"dash:room:accessError",roomId:o}),r.defer().promise;var u=[{label:"Close",cssClass:"btn-primary",dismiss:!0}];return s=e.isUndefined(s)||!!s,m.messageBox("Insufficient Access Permissions","Sorry, you don't have access to this room.",u).result.finally(function(){s&&a.localStorage.removeItem("lastRoom"),l(function(){c.go("rooms.index")});var o={hideMessage:!0};return t&&(o.message=t),r.reject([o])})},u}])});