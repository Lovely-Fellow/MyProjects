define(["./room","angular","lodash"],function(t,e,o){"use strict";t.directive("eoFavoriteStory",["$sce","$document","$window","$timeout","emojione","eoAuth","dateFilter","$filter","eoUsers","eoDashContext",function(r,s,a,i,d,n,m,c,l,y){return{restrict:"EA",replace:!0,transclude:!0,scope:!0,templateUrl:t.templatePath+"favorite-story-directive.html",controller:["$scope",function(e){e.toggleIsFavorite=function(t,e){t.stopPropagation(),y.isReadOnlyMode()||e.setFavorite(!e.getFavorite())},e.favoriteStoryActionsTemplate=t.templatePath+"favorite-story-actions-popover.html"}],compile:function(){return function(t,s,a){if(t.story){t.story.user?t.user=t.story.user:l.several([t.story.userId],!0).then(function(e){e&&e.length&&(t.user=e[0])}),t.id=t.story.storyId,t.timestamp=t.story.created,t.updated=m(t.story.updated,"EEEE, MMMM d, y h:mm a"),t.created=c("eoRoomTimestamp")(t.story.created,{today:"h:mm a",yesterday:"'Yesterday'",lastWeek:"EEEE",long:"shortDate"}),t.createdLong=m(t.story.created,"EEEE, MMMM d, y h:mm a"),t.title=t.$eval(a.title),t.message=r.trustAsHtml(t.story.messageHtml),t.highlight=!1,t.self=t.story.self;var i=t.$watch("story.storyId",function(e){t.id=e});if(t.story.metadata&&t.story.metadata.modified)t.modified=!0;else var d=t.$watch("story.fieldChanges",function(r){t.modified=e.isArray(r)&&o.some(r,{fieldChanged:"message"})});var n=t.$watch("story.updated",function(e){t.updated=m(e,"EEEE, MMMM d, y h:mm a")}),y=t.$watch("story.messageHtml",function(e){t.message=r.trustAsHtml(e)});t.$on("$destroy",function(){i(),d&&d(),n(),y()})}}}}}])});