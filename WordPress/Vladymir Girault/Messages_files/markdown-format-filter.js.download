define(["./common","angular","marked","./emojione-service","./dash-tag-filter"],function(e,t,r){"use strict";e.filter("upMarkdownFormat",["emojione","upDashTagFilter",function(e,n){function i(e){return e.replace(/[^\w\s]|_/g,function(e){return"%"+("0"+e.charCodeAt().toString(16)).slice(-2)})}function o(e){return e.replace(/&([#\w]+);/g,function(e,t){if(t=t.toLowerCase(),"#"===t.charAt(0))return"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1));switch(t){case"quot":return'"';case"lt":return"<";case"gt":return">";case"amp":return"&";default:return""}})}function s(t,n){return n=n||{},n.renderer=c,n.tables=n.tables||!1,n.breaks=!0,n.headerPrefix="___",n.emoji&&(t=e.shortnameToUnicode(t)),n.extended||(t=t.replace(/[[\]()]/g,function(e){return String.fromCharCode((e.charCodeAt()-39)%49)})),n.escaped&&(t=t.replace(/^&gt;/gm,">")),n.extended||(t=t.replace(/<((?:[@#%]|mailto:|(?:[a-z][a-z0-9+.-]*):\/\/)(?:[^|>]+))(?:\|([^>]+))?>/gi,function(e,t,r){return"["+i(r||"")+"]("+t+")"})),t=r(t,n),n.extended||(t=t.replace(/\[(.*?)\]\((.*?)\)/g,function(e,t,r){return t?unescape(t):r}).replace(/[\u0001-\u0005]/g,function(e){return String.fromCharCode(49*(e.charCodeAt()/3|0)+39+e.charCodeAt())})),n.emoji&&(t=e.toShort(t)),n.single&&(t=t.replace(/<\/?p>|<br>/g,"")),t}var u=r.InlineLexer.prototype.output,a=r.Lexer.prototype.token,l=function(){};l.exec=l,r.Lexer.prototype.token=function(){return this._origRules||(this._origRules=this.rules),this.rules=t.copy(this._origRules),this.rules.code=l,this.rules.hr=l,this.rules.html=l,this.options.extended||(this.rules.list=l,this.rules.heading=l,this.rules.lheading=l,this.rules.paragraph=new RegExp(this.rules.paragraph.source.replace(this._origRules.list.source.replace(/(^|[^\[])\^/g,"$1").replace("\\1","\\3")+"|","").replace(" *(#{1,6}) *([^\\n]+?) *#* *(?:\\n+|$)|","").replace(this._origRules.lheading.source.replace(/(^|[^\[])\^/g,"$1")+"|",""))),a.apply(this,arguments)},r.InlineLexer.prototype.output=function(){return this._origInlineRules||(this._origInlineRules=this.rules),this.rules=t.copy(this._origInlineRules),this.rules.reflink=l,this.rules.nolink=l,this.rules.tag=l,this.options.extended||(this.rules.url=l),u.apply(this,arguments)};var c=new r.Renderer;return c.text=function(t){return t=t.replace(/\n/g,"<br>"),this.options.emoji&&!this.options.toUnicode&&(t=e.toImage(t)),this.options.highlighter&&(t=this.options.highlighter(t)),t},c.link=function(e,t,r){return this.options.extended||(r=unescape(r)),n(o(e),o(r),this.options)},c.code=function(e,t){return r.Renderer.prototype.code.call(this,e,t,this.options.escaped)},c.codespan=function(e){return"<code>"+(this.options.escaped?o(e):e)+"</code>"},s}])});