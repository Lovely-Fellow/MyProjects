define(["./common","angular"],function(e,o){"use strict";e.factory("eoDashPopover",["$q","$window","$timeout","$rootScope","$compile","$controller",function(e,t,s,i,p,n){function r(r){function c(e,o){f.popover=o,f.repositionPopover()}var f=this;this.closed=!1,this.defer=e.defer(),this.result=this.defer.promise,this.scope=i.$new(),this.scope.dismiss=this.dismiss.bind(this),n(r.controller,{$scope:this.scope},!0,r.controllerAs)(),this.fauxHostElement=p(' <div class="faux-anchor"   eo-popover-hoverable="true"   eo-popover-responsive="false"   eo-popover-append-to-body="true"   eo-popover-trigger="eoPopoverShow"   eo-popover-is-open="isOpen"   eo-popover-dynamic-placement="false"   eo-popover-dynamic-position="false"   eo-popover-watch-content="true"   eo-popover-auto-close="false"   eo-popover-close="false"   eo-popover-animation="false"   eo-popover-size="lg"   eo-popover-placement="custom"   eo-popover-base-selector="faux-anchor"   eo-popover="'+r.templateUrl+'"> </div>')(this.scope),o.element(t.document.body).append(this.fauxHostElement),this.offset(r.element),this.scope.isOpen=!0,this.isOpenDeregister=this.scope.$watch("isOpen",function(e,o){e===o||!1!==e||f.closed||t.setTimeout(function(){f.dismiss("close")})}),this.scope.$on("$destroy",function(){f.isOpenDeregister()}),s(function(){f.offset(r.element)},0,!1);var h=this.scope.$on("eoPopoverPosition",c);this.scope.$on("$destroy",function(){h()})}return r.prototype.offset=function(e){this.hostElement=e,this.repositionPopover()},r.prototype.repositionPopover=function(){if(this.hostElement&&this.popover){var e=this.hostElement.offset(),o=this.popover;if(o&&o.length>0){var s=0,i=o.outerWidth();e.left+i>t.innerWidth&&(s=Math.abs(t.innerWidth-e.left-i),e.left-=s),e.top-=o.outerHeight()+15,o.offset(e);o.find(".arrow").css("left",25+s+"px")}}},r.prototype.dismiss=function(e){this.closed=!0,this.scope.isOpen=!1,this.defer.resolve(e),this.scope.$destroy(),this.fauxHostElement.remove()},{open:function(e){return new r(e)}}}])});