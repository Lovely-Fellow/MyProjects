define(["./room","angular"],function(t,e){"use strict";t.directive("favoriteStoriesModalContent",["$timeout",function(t){return{restrict:"A",link:function(e,o){var r=e.$on("page-change",function(){t(function(){o.find(".modal-body").scrollTop(0)})});e.$on("$destroy",r)}}}]),t.controller("eoFavoriteStories",["$rootScope","$scope","$q","$window","$timeout","eoFavoriteStories",function(t,o,r,n,i,a){function s(t,e){return a.getFavoriteStories(t,e)}this.currentPage=1,this.originalPage=this.currentPage,this.itemsPerPage=25,this.totalItems=0,this.items=[],this.loading=!0;var c=this,u=t.$on("$stateChangeStart",function(){o.$close(!0)}),g=t.$on("notification:click",function(){o.$close(!0)}),l=t.$watch(function(){return c.currentPage},function(t,e){t!==e&&(c.originalPage=c.currentPage,c.goToPage().catch(function(){c.currentPage=c.originalPage||1}))});o.$on("$destroy",function(){u(),g(),l()}),this.close=function(){o.$close(!0)},this.isPaginated=function(){return c.totalItems>c.itemsPerPage},this.goToPage=function(){return s(c.currentPage,c.itemsPerPage).then(function(t){delete c.error,c.totalItems=t.total,c.totalPages=Math.ceil(c.totalItems/c.itemsPerPage),c.onFirstPage=1===c.currentPage,c.onLastPage=c.currentPage===c.totalPages,c.items=t.stories,c.currentPageStart=(c.currentPage-1)*c.itemsPerPage+1,c.currentPageEnd=c.currentPageStart+c.items.length-1,i(function(){o.$emit("page-change"),c.loading=!1})}).catch(function(t){return c.error="Sorry about this. We're having trouble communicating with our server.",r.reject(t)}).finally(function(){i(function(){n.dispatchEvent(new Event("resize"))})})},this.goToStory=function(t,r){return"A"!==t.target.tagName&&!e.element(t.target).closest("[eo-user-id]").size()&&o.open(r.roomId,r.storyId).then(function(){o.$close()})},this.goToPage()}]),t.factory("eoFavoriteStoriesModal",["$modal",function(e){return{showFavoriteStories:function(o){return e.open({templateUrl:t.templatePath+"favorite-story-modal.html",controller:"eoFavoriteStories as favoriteStories",windowClass:"favorite-stories-modal modal-sticky",scope:o}).result}}}])});