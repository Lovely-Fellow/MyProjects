define(["./common","angular"],function(e,i){"use strict";e.controller("upGiphyModalCtrl",["upGiphy","eoDashConfig","$modalInstance","$scope","_query",function(e,a,n,t,o){var l=this,u=a.feature.giphy.image.preview,r=a.feature.giphy.image.live;l.query=o,l.output=null,l.submit=function(){l.output?n.close(l.output):n.dismiss()},l.shuffle=function(){l.error=!1,l.loading=!0,l.image=null,e.translate(l.query).then(function(e){if(e&&e.images&&(e.images[u]||e.images[r])){var i=e.images[u];(!i||e.images[r]&&1*e.images[r].size<1*i.size)&&(i=e.images[r]),l.url=e.url,l.image=i.url,l.output={url:e.url,title:e.title,image:e.images[a.feature.giphy.image.live]||e.images[a.feature.giphy.image.preview]}}else l.error="Unknown error calling Giphy API",l.output=null},function(e){l.output=null,l.error=e&&e.message?e.message:i.isString(e)&&e||"Unknown error calling Giphy API"}).finally(function(){l.image||(l.loading=!1)})},l.imageLoaded=function(){l.loading=!1},l.shuffle()}]),e.directive("upGiphyModalImageLoaded",function(){return{restrict:"A",link:function(e,i,a){i.bind("load",function(){e.$apply(a.upGiphyModalImageLoaded)}),i.bind("error",function(){e.$apply(a.upGiphyModalImageLoaded)})}}}),e.factory("upGiphyModal",["eoModal",function(i){return{open:function(a){return i.custom({locals:{_query:a},templateUrl:e.templatePath+"giphy-modal.html",controller:"upGiphyModalCtrl as giphy",windowClass:"modal-sticky"}).result}}}])});