define(["angular","./room","./room-service"],function(e,t){"use strict";t.factory("eoRoomCollection",["$injector","$q",function(t,n){var r={findById:function(e){for(var t,n=0;t=this[n++];)if(t.roomId===e)return t},getActive:function(){for(var e,t=0;e=this[t];){if(e.active)return e;t++}},update:function(e){for(var t,n=0;t=this[n];){if(t.roomId===e.roomId){t!==e&&t.updatedRoom(e);break}n++}},totalUnread:function(){for(var e,t=0,n=0;e=this[t++];)e.numUnread&&(n+=e.numUnread);return n},add:function(e){var r=this,o=t.get("eoRooms").processRoomData(e),i=r.findById(o.roomId);return i?n.when(i):(r.push(o),o.preloadData().then(function(){return r.update(o),o}))},remove:function(e){var n=this.findById(e),r=this.indexOf(n);r>=0&&(t.get("eoRooms").removeFromCache(e),this.splice(r,1))},getMostRecentRoom:function(e,t){for(var n,r,o=0;n=this[o++];)e&&e===n.roomId||t&&n.numUnread||!n.isHidden&&n.recentTimestamp&&(!r||n.recentTimestamp>r.recentTimestamp)&&(r=n);return r},getInvitableRooms:function(e,t,n){var r,o=0,i=0,a=[];for(this.sort(function(e,t){return e.recentTimestamp<t.recentTimestamp?1:e.recentTimestamp>t.recentTimestamp?-1:0});r=this[o++];)!r.canInvite()||r.isReadOnly||r.getUser(e,t)||n&&!(i<n)||(a.push(r),i++);return a},resetKeepUnread:function(){for(var e,t=0;e=this[t++];)e.keepUnread=!1}};return{mixInto:function(t){return e.extend(t,r)}}}])});