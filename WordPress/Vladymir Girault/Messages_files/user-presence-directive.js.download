define(["./common","angular"],function(e,a){"use strict";e.directive("eoUserPresence",["$compile","$rootScope","$http","$templateCache","eoUserPresence","eoDashConfig",function(t,r,s,i,n,o){return{restrict:"E",templateUrl:e.templatePath+"user-presence-directive.html",link:function(e,t,r){function s(){p="",t.removeClass("glyphicon air-icon-avatar fallback-avatar")}function i(){e.initials="",p="glyphicon air-icon-avatar fallback-avatar ",t.addClass(p)}var c=r.presence;r.presenceUser&&(c=function(){return n.presence[e.$eval(r.presenceUser)]}),r.photoTip="true"===r.photoTip||!1,r.scale=r.scale||"xs",e.odeskBaseURL=o.odeskBaseURL;var l="avatar avatar-"+r.scale+" user-presence-icon-photo "+r.scale+" ",p="";a.isDefined(r.userInfo)?e.$watch(r.userInfo,function(a){if(a)if(a.photoUrl)e.initials="",t.css("background-image","url("+a.photoUrl+")"),s();else{t.css("background-image","none"),e.showPhotoTip="true"===String(r.photoTip);var n=a.personName;n&&n.firstName&&n.lastName?(s(),e.initials=n.firstName.substring(0,1).toUpperCase()+n.lastName.substring(0,1).toUpperCase()):i()}}):i(),e.$watch(c,function(e){e?"invisible"===e.toLowerCase()&&(e="offline"):e="none",t.prop("title",e).attr("class",l+p+e)})}}}])});