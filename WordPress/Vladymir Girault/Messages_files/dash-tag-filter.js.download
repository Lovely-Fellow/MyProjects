define(["./common","angular"],function(e,t){"use strict";e.filter("upDashTag",["eoExternalLinkChecker","eoAuth",function(e,r){function o(e,r,o,n){var i=t.element("<div/>").append(t.element("<a/>").attr("href",r).attr(o||{}).html(n?n(e):e)),l=i.html();return i=null,l}function n(e){var r=t.element("<div/>").append(t.element("<eo-story-header/>").attr(e||{})),o=r.html();return r=null,o}function i(t,r,n){/^mailto:|:\/\//i.test(t)||(t="http://"+t);var i=e.process(t);return!1!==i?o(n.extended?r:r||t,t,i,n.highlighter):n.extended?r===t?"&lt;"+t+"&gt;":"["+r+"]("+t+")":"&lt;"+t+(r?"|"+r:"")+"&gt;"}return function(e,t,l){if(l=l||{},l.extended)return i(e,t,l);var a,u,s,d,h,m="";switch(e.charAt(0)){case"@":u=e.slice(1).split(":"),s=u[0],d=u[1],a="0"===s||s===r.user.userId&&(!d||d===r.user.orgId),h={},a&&(l.mention&&l.mention("0"!==s),h.class="highlight"+("0"===s?" mention-room":"")),l.roomId&&(h["eo-user-room"]=l.roomId),"0"!==s&&(h["eo-user-id"]=s,d&&(h["eo-user-org-id"]=d)),m=o(t,"",h,l.highlighter);break;case"#":s=e.slice(1),m=o(t,"",{"eo-room-id":s},l.highlighter);break;case"%":u=e.slice(1).split(":"),s=u[0],d=u[1],h={},h["user-id"]=s,h["org-id"]=d,l.roomId&&(h["room-id"]=l.roomId),(u[2]||t)&&(h["integration-story"]=!0,h["photo-url"]=u[2]&&u[2].replace("%3A",":"),h["full-name"]=t),m=n(h);break;default:m=i(e,t,l)}return m}}])});