define(["./room","angular","lodash"],function(e,t,n){"use strict";e.factory("eoRoomPresence",["eoUserPresence","eoAuth",function(e,s){function r(e){this.userIds={},this.targetUserId=e,this.presence="none",this.presenceChangedBind=this.presenceChanged.bind(this),this.started=!1}return r.prototype.getPresence=function(){return this.presence},r.prototype.presenceChanged=function(e){this.presence!==e.presence&&this.userIds[e.userId]&&this._calculatePresence()},r.prototype.setUsers=function(n){var s=this;e.fetch(n).then(function(){s.userIds={},t.forEach(n,function(e){s.userIds[e]=!0}),s._calculatePresence(),s.started||(s.started=!0,e.subscribe({next:s.presenceChangedBind}))})},r.prototype.addUser=function(t){var n=this;e.fetch(t).then(function(){n.userIds[t]=!0,n._calculatePresence()})},r.prototype.removeUser=function(e){delete this.userIds[e],this._calculatePresence()},r.prototype._calculatePresence=function(){var t=this,r="none";n.each(t.userIds,function(n,c){if(c!==s.user.userId&&c!==t.targetUserId){var o=e.get(c);if("online"===o)return r="online",!1;"away"===o?r="away":"none"===r&&o&&(r=o)}}),t.presence=r},{create:function(e){return new r(e)}}}])});