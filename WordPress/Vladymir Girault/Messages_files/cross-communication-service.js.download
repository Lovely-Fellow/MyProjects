define(["./common","./video-feedback-dialog"],function(a){"use strict";a.constant("CROSS_COMMUNICATION_ALLOWED_PATTERN",/^(https?:\/\/.+\.(upwork|odesk)\.com(?::\d{1,5})?)/),a.service("eoCrossCommunication",["$rootScope","$window","$state","$urlRouter","$location","$exceptionHandler","eoDashContext","eoVideoFeedbackDialog","CROSS_COMMUNICATION_ALLOWED_PATTERN",function(a,t,e,n,o,s,r,i,d){function c(a,e){if(e||(e="*"),t.parent)try{t.parent.postMessage(a,e)}catch(a){s(a)}}function g(s){t.addEventListener("message",function(r){if((r.origin||r.originalEvent.origin).match(d)){var c=r.data;switch(c.type){case"dash:state:go":if(c.data.url)o.url(c.data.url),n.sync();else if(c.data.state){var g=c.data.state;g.params.force=!0,e.go(g.name,g.params)}break;case"dash:company:change":c.data.orgId&&s.changeCompany(c.data.orgId).then(function(){o.path("/")});break;case"dash:video:closed":i.showDialog(c.room);break;case"dash:widget:update":t.widgetOptions&&t.widgetOptions.enabled&&(c.data.flags||""===c.data.flags)&&(t.widgetOptions.flags={},c.data.flags.split(",").map(function(a){a.length&&(t.widgetOptions.flags[a]=!0)}),a.$broadcast("updateWidget"))}}}),a.$on("$stateChangeSuccess",function(){if(t.parent){var a=e.href(e.current.name,e.params,{absolute:!1});c({type:"dash:state:changed",data:{state:{name:e.current.name,url:e.current.url},url:a}})}}),a.$on("$stateChangeError",function(a,e,n,o,s,r){t.parent&&c({type:"dash:state:error",data:{toState:e.name,toParams:n,errors:r}})})}return{install:g,postParent:c}}])});