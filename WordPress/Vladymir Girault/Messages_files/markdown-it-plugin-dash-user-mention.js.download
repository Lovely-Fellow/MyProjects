define(["./markdown-it-plugin-dash-helpers"],function(e){"use strict";return function(r,s){function n(e,r){var n,o,t,i,a,u,c,h,m,d,p,f=e.pos,l=e.posMax;if(60!==e.src.charCodeAt(f)||64!==e.src.charCodeAt(f+1))return!1;for(f+=2,o=f;f<l;){if(":"===e.src.charAt(f)){n=f;break}f++}if(!n)return!1;for(f++,a=f;f<l;){if("|"===e.src.charAt(f)){i=f;break}f++}if(!i)return!1;for(f++,h=f;f<l;){if(">"===e.src.charAt(f)){c=f;break}f++}return!!c&&(f++,t=e.src.slice(o,n),u=e.src.slice(a,i),e.src.slice(h,c),d="0"===t||t===s.user.userId&&(!u||u===s.user.orgId),d&&(e.env.mention&&e.env.mention("0"!==t),m="highlight"+("0"===t?" mention-room":"")),r||(p=e.push("dash_user_mention_open","a",1),p.attrs=[["href",""],["eo-user-id",t],["eo-user-org-id",u]],e.env.roomId&&p.attrs.push(["eo-user-room",e.env.roomId]),m&&p.attrs.push(["class",m]),e.pos=h,e.posMax=c,e.md.inline.tokenize(e),e.push("dash_user_mention_close","a",-1)),e.pos=f,e.posMax=l,!0)}function o(r){a.test(r.src)&&(r.src=r.src.replace(a,function(r){return e.mask(r)}))}function t(r){var s,n,o=!1;for(s=r.length-1;s>=0;s--)n=r[s],"text"===n.type&&o&&(n.content=e.demask(n.content)),"dash_user_mention_close"===n.type&&(o=!0),"dash_user_mention_open"===n.type&&(n.attrSet("eo-user-room",e.demask(n.attrGet("eo-user-room"))),o=!1)}function i(e){var r;for(r=e.tokens.length-1;r>=0;r--)"inline"===e.tokens[r].type&&t(e.tokens[r].children)}r.inline.ruler.push("dash_user_mention",n);var a=new RegExp("(<@[^|]+\\|)([^>]*?["+e.maskableOperators.join("")+"]+[^>]*)?(>)","gm");r.core.ruler.before("normalize","dash_user_mention_mask",o),r.core.ruler.push("dash_user_mention_demask",i)}});