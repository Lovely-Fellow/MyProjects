define(["./common"],function(e){"use strict";e.factory("eoExternalLinkChecker",["eoDashConfig","eoDashContext","$window","$state",function(e,t,i,r){var o=e.whitelistedURLs.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp("(^|\\/|\\.)("+o.split(",").join("|")+")$"),a=new RegExp("^"+e.baseURL.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"\\/"),s=new RegExp("^"+e.odeskBaseURL.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"\\/"),l=new RegExp("^"+(r.href("rooms.chat",{id:"roomID"},{absolute:!0})||"roomID").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace("roomID","(room_[^/]*)$")),d="(https?|chrome|facetime|s?ftp|git|irc|ssh|svn)",g=new RegExp("^("+d+"://|mailto:)","i");return{allowedSchemes:d,addWarning:function(t){if(!t.length)return t;var r=t.replace(/^.*:\/\//,"").split(/[:\/?]/g)[0];if(n.test(r))return t;var o=e.externalUrlRouter+i.encodeURIComponent(t);return 0===t.indexOf("mailto:")&&(o=t),o},process:function(e){var r=e.match(l);if(r)return{"eo-room-id":r[1]};var o;if(o=a.test(e)||0===e.indexOf("mailto:")||s.test(e)&&(t.isWidget()&&i.widgetOptions.flags.upwork||t.isMobile())?{}:{target:"_blank",rel:"noopener noreferrer"},!t.isWidget()&&!t.isMobile()||o.target||(o.target="_parent"),a.test(e)&&e.indexOf("/upvideo/")>0){var n=Math.floor(.9*i.innerWidth);n<820&&(n=820);var d=Math.floor(.9*i.innerHeight);return d<500&&(d=500),t.isTeamApp()?{onclick:"var videoWindow = window.open('', '', 'width="+n+", height="+d+"'); videoWindow.location = "+JSON.stringify(e)+"; return false;",window:{width:n,height:d}}:{onclick:"window.open("+JSON.stringify(e)+", '', 'width="+n+", height="+d+"');return false;",window:{width:n,height:d}}}return!!g.test(e)&&o}}}])});