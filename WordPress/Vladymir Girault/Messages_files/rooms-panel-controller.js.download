define(["angular","lodash","dompurify","cssparser"],function(e,t,n,o){"use strict";return["$scope","$stateParams","$state","$element","$sce","room","eventLog","eoAuth","eoGoogleAnalytics","eoExternalLinkChecker",function(r,i,a,l,s,u,d,c,p,m){var f=t.find(r.panels,{id:i.panel});if(!f)return a.go("rooms.chat",{id:i.id}),!1;var g=this;g.isLoading=!0,g.panelId=f.id,g.panelLabel=f.label;var v=function t(n){var o;if("stylesheet"in n&&t(n.stylesheet),"rules"in n&&e.isArray(n.rules))for(o=0;o<n.rules.length;++o)t(n.rules[o]);if("selectors"in n&&e.isArray(n.selectors))for(o=0;o<n.selectors.length;++o)n.selectors[o]="#side-panel "+n.selectors[o]},A=function(t){n.addHook("uponSanitizeElement",function(e,t){if("style"===t.tagName){var n=e.textContent,r=o.parse(n,{silent:!0});return v(r),e.textContent=o.stringify(r),e.textContent}}),n.addHook("uponSanitizeAttribute",function(e,t){"A"!==e.tagName&&"target"===t.attrName&&(t.keepAttr=!1)}),n.addHook("afterSanitizeAttributes",function(e){if("A"===e.tagName){var t=m.process(e.href);for(var n in t)e.setAttribute(n,t[n])}});var r=l.find(".panel-content");if(r.html("").append(n.sanitize(t,{RETURN_DOM_FRAGMENT:!0,RETURN_DOM_IMPORT:!0,ADD_ATTR:["target","eo-user-id","eo-user-org-id","eo-user-room"]})),f.plugin){f.plugin.openPanel=i.panel;var a={"data-dash-onclick":"click","data-dash-onmouseover":"mouseover"},s=function(t){f.plugin.remote[t]&&e.isFunction(f.plugin.remote[t])&&f.plugin.remote[t]()};for(var u in a)r.find("["+u+"]").on(a[u],function(e){return function(t){s(t.target.getAttribute(e))}}(u))}g.isLoading=!1};e.isFunction(f.renderer)?f.renderer(u.roomId,function(e){e&&A(e)}):A(f.renderer),r.$onRootScope("panel:dom",function(t,n,o,r){if(n===i.panel){var a=l.find(r),s=null,d=Array.prototype.slice.call(arguments,4);"val"===o&&d[0]&&e.isFunction(d[0])&&(s=d.shift());var c=a[o].apply(a,d);s&&s(u.roomId,c)}});var h={event:"click",location:"room nav header",sublocation:"room panel "+f.id,timestamp:new Date,userId:c.user.userId,data:[{org_id:c.user.orgId,room_id:u.roomId,action:'room app panel "'+f.id+'" displayed'}]};d.log(h),h=null,p.ga("send","event",'room panel "'+f.id+'" in room nav header','click to open room panel "'+f.id+'"',"room id: "+u.roomId),r.$on("$destroy",function(){n.removeHook("uponSanitizeElement"),n.removeHook("uponSanitizeAttribute"),n.removeHook("afterSanitizeAttributes"),f=null,g=null,v=null,A=null})}]});