define(["./common"],function(e){"use strict";e.factory("eoPluginsDetailService",["$http","$q","tlPlugins","eoSearch","eoRooms",function(t,n,r,o,a){var i={},u=function(e){return e.room.roomName},g=function(e){return e.room.topic};i.getApplicationById=function(e){return r.getApplicationById({appId:e})},i.getIntegrationById=function(e){return r.getIntegrationById({integrationId:e})},i.createNewIntegration=function(e,t,n,o){return r.createIntegration({integration:{applicationId:e,orgId:t,roomId:n,userId:o}}).catch(function(e){return i.displayFriendlyError(e[0])})},i.refreshIntegrationToken=function(e){return r.refreshSharedSecret({integrationId:e}).catch(function(e){return i.displayFriendlyError(e[0])})},i.saveNewSettings=function(e,t,n,o){return r.updateIntegration({integration:{integrationId:e,integrationIconURL:n,integrationName:t,roomId:o}}).catch(function(e){return i.displayFriendlyError(e[0])})},i.disableIntegration=function(e,t){return r.updateIntegration({integration:{integrationId:e,enabled:t}}).catch(function(e){return i.displayFriendlyError(e[0])})},i.deleteIntegration=function(e){return r.deleteIntegration({integrationId:e}).catch(function(e){return i.displayFriendlyError(e[0])})},i.getSetupTemplate=function(t){return e.templatePath+"plugin-setup-templates/"+(t||"not-found.html")},i.getGoogleOauthUrl=function(){return r.getGoogleOauthUrl({})},i.googleDriveStoreAccessToken=function(e,t,n,o){return r.googleDriveStoreAccessToken({userId:e,orgId:t,code:n,state:o})},i.isAuthorized=function(e,t){return r.isAuthorized({userId:e,orgId:t}).then(function(e){return e.authorized})},i.getTokenOrAuthorizationUrl=function(e,t){return r.getTokenOrAuthorizationUrl({userId:e,orgId:t})},i.googleDriveLogout=function(e,t){return r.googleDriveLogout({userId:e,orgId:t,userAndAppInfo:{}})},i.getIntegrationsGroupedByApplications=function(e){return r.getIntegrationsGroupedByApplications({self:e})},i.getIntegrationsGroupedByApplicationId=function(e,t){return r.getIntegrationsGroupedByApplicationId({applicationId:e,self:t})},i.searchForRooms=function(e){return o.browse(e,"rooms",5,0,"lastActivity","desc",!0).then(function(e){return a.settleDuplicates(e.records,u,g)})},i.displayFriendlyError=function(e){if(e.message){var t=e.message.split("tErrorCode: '");if(t.length>1)return e.message=i.getMessageByErrorCode(parseInt(t[1].replace("'",""))),e}return e.message="Unknown error. Please refresh and try again.",e};var d={101:"An archived room cannot be associated with an integration",102:"Cannot enable an integration that is part of an archived room",103:"Having trouble getting the room info. Please try again",104:"You are not a member of this room, please request access from the owner or try another room",105:"You are not authorized to perform this operation",106:"Integration was not found. Please refresh your browser",107:"You do not have permission to post to that room. Please try a different room",108:"This integration is not part of your company"};return i.getMessageByErrorCode=function(e){return d[e]},i.hasAccess=function(e){return r.hasAuthorized({applicationId:e})},i.googleCalendarLogout=function(){return r.googleCalendarLogout()},i.getGoogleCalendarOauthUrl=function(){return r.getGoogleCalendarOauthUrl().then(function(e){return e.url})},i.googleCalendarStoreAccessTokenFromOauthCode=function(e){return r.googleCalendarStoreAccessTokenFromOauthCode({oauthCode:{authCode:e}})},i.getGoogleCalendars=function(){return r.getGoogleCalendars()},i.createGoogleCalendarIntegration=function(e,t){return r.createGoogleCalendarIntegration({integration:{calendars:e.map(function(e){return{id:e}}),roomId:t}})},i.updateGoogleCalendarIntegration=function(e,t,n,o){return r.updateGoogleCalendarIntegration({integration:{integrationId:n,calendars:e.map(function(e){return{id:e}}),roomId:t,enabled:o}})},i.getGoogleCalendarIntegrationById=function(e){return r.getGoogleCalendarIntegrationById({integrationId:e})},i.deleteGoogleCalendarIntegration=function(e){return r.deleteGoogleCalendarIntegration({integrationId:e})},i.getGoogleDriveAppId=function(){return r.getApplicationList().then(function(e){for(var t=0;t<e.applications.length;t++)if(e.applications[t].hasOwnProperty("appName")&&"Google Drive"===e.applications[t].appName)return e.applications[t].appId;return null})},i}])});