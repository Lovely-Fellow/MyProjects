define(["../plugins-webhooks/integration-detail","angular"],function(){"use strict";return["$scope","$state","$q","$window","$modal","applicationId","eoRooms","eoRoomDialog","eoAuth","eoPluginsDetailService","integrationId",function(e,o,n,t,a,i,l,r,d,s,u){e.isClient=d.isClient(),e.isClient=!0,e.application="",e.setupTemplate="",e.roomSelection=[],e.defaultRoomId="",e.calendarSelections=[],e.showErrorMessage=!1,e.errorMessageFromBE="",e.editMode=!1,e.defaultCalendars=[],e.roomName="Select a room",e.enabled="Disable",u&&(e.editMode=!0,s.getGoogleCalendarIntegrationById(u).then(function(o){e.integration=o,e.roomName=o.roomName,e.defaultRoomId=o.roomId;for(var n=0;n<o.calendars.length;n++)e.defaultCalendars.push(o.calendars[n].id),e.calendarSelections.push(o.calendars[n].id);o.enabled<1&&(e.enabled="Enable")})),s.getApplicationById(i).then(function(o){e.application=o}),e.isAuthorized=!1,s.hasAccess(i).then(function(o){e.isAuthorized=o,o&&s.getGoogleCalendars().then(function(o){e.calendars=o.calendars})}),e.googleOauthUrl="",s.getGoogleCalendarOauthUrl().then(function(o){e.googleOauthUrl=o}),e.logoutGoogle=function(){a.promptBox("Confirm logout","Do you really want to logout from Google for the Upwork App?").result.then(function(e){e&&s.googleCalendarLogout().then(function(){o.go("plugins.existingintegrations",{self:!0})},function(e){t.alert(e[0].message)})})},e.deleteIntegration=function(){a.promptBox("Confirm Removal","Do you really want to delete this integration?").result.then(function(e){e&&s.deleteGoogleCalendarIntegration(u).then(function(){o.go("plugins.existingintegrations",{self:!0})},function(e){t.alert(e[0].message)})})},e.disableIntegration=function(){"Disable"===e.enabled?a.promptBox("Confirm Disable","Do you really want to disable this integration?").result.then(function(o){if(o){var n=c();s.updateGoogleCalendarIntegration(e.calendarSelections,n,u,0).then(function(){e.enabled="Enable"})}}):a.promptBox("Confirm Enable","Do you really want to enable this integration?").result.then(function(o){if(o){var n=c();s.updateGoogleCalendarIntegration(e.calendarSelections,n,u,1).then(function(){e.enabled="Disable"})}})},e.addBuildVersion=function(e){return e?e+"?"+t.dashVersion:void 0},e.getRoomSearch=function(e){return s.searchForRooms(e)},e.addCalendar=function(o,n){if(o.target.checked)e.calendarSelections.push(n);else{var t=e.calendarSelections.indexOf(n);t>-1&&e.calendarSelections.splice(t,1)}},e.addGoogleCalIntegration=function(){a.promptBox("Confirm","Are you finished selecting calendars to integrate?").result.then(function(n){if(n)if(e.editMode){var t=c();s.updateGoogleCalendarIntegration(e.calendarSelections,t,u,e.integration.enabled).then(function(){o.go("plugins.existingintegrations",{self:!0})})}else e.roomSelection.roomInput?s.createGoogleCalendarIntegration(e.calendarSelections,e.roomSelection.roomInput.room.roomId).then(function(){o.go("plugins.existingintegrations",{self:!0})}):e.noRoomSelected=!0})},e.roomSelection.selectedRooms=[],e.isCalendarChecked=function(o){return!(e.defaultCalendars.length<1)&&e.defaultCalendars.indexOf(o)>-1};var c=function(){return e.roomSelection.roomInput&&e.roomSelection.roomInput.room.roomId.length>3?e.roomSelection.roomInput.room.roomId:e.defaultRoomId}}]});