define(["./common"],function(e){"use strict";e.factory("eoFiles",["$q","$http","$interpolate","eoDashConfig","eoDashContext","eoOauth","tlCollabFiles","eventLog","eoAuth",function(e,t,i,a,l,n,o,r,s){function c(e,t,i){this.valid=e,this.reason=t,this.message=i}function u(e){return null===e.name.match(new RegExp(a.filePatternsBlackList,"i"))}function d(e){return e.size<=1024*a.maxFileSize*1024}function f(e){return e.size>0}function h(e){return"directory"===e.type||!e.type&&0===e.size}return{validateDropboxFile:function(e){return u(e)?new c(!0):new c(!1,"File Type Not Supported","Sorry, this is an executable file. For security reasons, Upwork does not allow you to send this type of file.")},validateFile:function(e){return h(e)?new c(!1,"Directories Disallowed","Sorry, directories are disallowed. Please zip the directory to upload it's contents."):u(e)?f(e)?d(e)?new c(!0):new c(!1,"File Too Large",i("Sorry, this file is too large for us to upload. Please attach files under {{limit}}MB")({limit:a.maxFileSize})):new c(!1,"File Too Small","Sorry, this file is too small for us to upload.  Files must be larger than 0 bytes"):new c(!1,"File Type Not Supported","Sorry, this is an executable file. For security reasons, Upwork does not allow you to send this type of file.")},commitFiles:function(e){return o.confirm({fileUids:e})},_linksByFileCache:{},createSharedFileLink:function(e,c){if(Object.keys(this._linksByFileCache).length>1e3){var u={event:"file_link_cache",location:"dash",sublocation:"dash-attachments",timestamp:new Date,userId:s.user.userId,data:[{"file-link-cache-size":Object.keys(this._linksByFileCache).length}]};r.log(u)}return this._linksByFileCache[e.fileId]||(this._linksByFileCache[e.fileId]=function(){var u=null;if(e.afs)u=o.createShareUrl({fileUid:e.fileId}).then(function(e){return e.fileUrl});else{var d=i("{{baseUrl}}/link/{{spaceId}}/{{fileId}}/{{fileName}}")({baseUrl:a.shareLinkUrl,spaceId:e.spaceId,fileId:e.fileId,fileName:encodeURIComponent(e.fileName)});c&&(d+="?alt="+c);var f={};l.useOauth2()&&(f={Authorization:"Bearer "+n.getToken()}),u=t.post(d,{},{headers:f}).then(function(t){if(!t||!t.data){console.warn("Failed to create Shared link for attachment");var i={event:"shared_file_link_failed",location:"dash",sublocation:"dash-attachments",timestamp:new Date,userId:s.user.userId,data:[{file_id:e.fileId}]};return r.log(i),{}}return t.data.data})}return u}()),this._linksByFileCache[e.fileId]},getUploadLink:function(e){return i("{{baseUrl}}/{{spaceId}}")({baseUrl:a.fileUploadURL,spaceId:e})}}}])});