define(["./common","angular","markdownIt","highlightjs","./markdown-it-plugin-dash-blockquote","./markdown-it-plugin-dash-user-mention","./markdown-it-plugin-dash-room-mention","./markdown-it-plugin-dash-author-header","./markdown-it-plugin-dash-link","./markdown-it-plugin-dash-code-inline","./markdown-it-plugin-dash-fence","./markdown-it-plugin-dash-emoji","./markdown-it-plugin-dash-highlighter","./markdown-it-plugin-dash-link-open","./markdown-it-plugin-jira-link","./markdown-it-plugin-dash-checkbox","./emojione-service","./external-link-checker-service","config-service"],function(n,e,i,r,t,o,a,u,l,s,h,d,g,c,m,k){"use strict";n.filter("upMarkdownItFormat",["emojione","eoExternalLinkChecker","eoAuth","eoDashConfig","$log",function(n,e,p,f,w){function v(){var e=i("commonmark");return e.use(s).use(h).use(d,n).use(g).use(m,f,p).disable(["code","hr","reference","image","html_inline"]).enable(["strikethrough"]).set({breaks:!0,xhtmlOut:!1,html:!1,highlight:function(n,e){if(e&&r.getLanguage(e))try{return r.highlight(e,n).value}catch(n){}return""}}),e}function b(n){return n=j(n)}function j(n){return n.replace(/((^|[^\\])(\\\\)*\\[<&])/g,function(n){return n.replace(/\\/,"\\\\")})}var x={note:function(){var n=v();return n.use(c,e).use(k),n}(),story:function(){var n=v();return n.disable(["autolink","link","heading","lheading","code"]).use(t).use(o,p).use(a).use(u).use(l,e),n}()};return function(n,e){if("string"!=typeof n)return w.warn("[Markdown Formatter]: The input string is invalid"),"";e=e||{};var i=x[e.extended?"note":"story"],r=i.render(b(n),e);return e.single?r.replace(/<\/?p>|<br>/g,""):r}}])});