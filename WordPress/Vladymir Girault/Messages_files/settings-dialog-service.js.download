define(["./common","angular","buzz","lodash"],function(e,t,i,n){"use strict";e.controller("settingsDialogNotifCtrl",["$modalInstance","$rootScope","eoNotification","eoDashConfig","eoDashContext","eoUsers","eoAuth","eoTourService","deviceDetector",function(e,t,o,s,a,r,l,u,c){var m=this;m.dashEmailFrequencies=[{value:"immediate",label:"Immediate"},{value:"fifteen_minutes",label:"Every 15 minutes"},{value:"hourly",label:"Once an hour"},{value:"daily",label:"Once a day"}],m.isMobileDevice=c.isMobile(),m.noSendOnEnter="false";var d=r.getUserSettings(l.user.userId);d=d.then(function(e){m.desktop=e.notifications&&e.notifications.desktop,m.email=e.notifications&&e.notifications.email,m.emailPresence=e.notifications.emailPresence,m.counter=e.counter.show,m.emailApproximately=e.notifications&&e.notifications.emailApproximately,!n.isEmpty(m.emailApproximately)&&m.emailApproximately.match(/^(immediate|fifteen_minutes|hourly|daily)$/)||(m.emailApproximately="fifteen_minutes"),m.sound=e.notifications&&e.notifications.sound,m.granted=o.granted,m.alwaysAsk=function(){return!m.isMobileDevice&&!a.isTeamApp()&&o.alwaysAsk()},m.noSendOnEnter=(e.composer&&e.composer.noSendOnEnter)+"",m.hideUrlPreview=(e.url&&e.url.hidePreview)+""}),m.disableSave=function(){return m.inProgress||a.isReadOnlyMode()},m.submit=function(){var i={notifications:{desktop:m.desktop,email:m.email,emailApproximately:m.emailApproximately,sound:m.sound,emailPresence:m.emailPresence},counter:{show:m.counter},composer:{noSendOnEnter:"true"===m.noSendOnEnter},url:{hidePreview:"true"===m.hideUrlPreview}};m.inProgress=!0,r.saveUserSettings(l.user.userId,i).then(function(){m.inProgress=!1,t.$emit("settings:changed"),e.close()},function(){m.inProgress=!1,e.dismiss()})},m.requestNotif=function(){o.request()},m.test=function(){o.show("Success",{body:"You have successfully enabled desktop notifications."})},m.getTextFromDictionary=function(e){return{all:"All activity",important:"Important activity only",none:"Nothing"}[e]||""};var f=new i.sound(s.assets.url+s.soundsPath+"/dash-ding",{formats:["ogg","mp3"]});m.testSound=function(){f.play()},m.updateTourSetting=function(){u.getSettings().then(function(e){e.composerSettingPopup||u.updateSettings({composerSettingPopup:!0})})}}]).factory("eoSettingsDialog",["eoModal",function(t){var i=e.templatePath+"settings-dialog-";return{notifSettings:function(){return t.custom({templateUrl:i+"notifications.html",controller:"settingsDialogNotifCtrl as notif",windowClass:"notifications"})}}}])});