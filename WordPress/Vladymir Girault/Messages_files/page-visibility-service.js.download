define(["./common","angular"],function(i,e){"use strict";i.factory("eoPageVisibility",["$window","$document","$rootScope","eoDashContext",function(i,t,n,o){function r(i){return e.isString(i)&&i.length&&(i=i.substring(0,1).toLowerCase()+i.substring(1)),i}function s(){if(!e.isString(c))for(var i=["","moz","ms","o","webkit"],n=0;n<i.length;n++){var o=i[n]+"Hidden";if(r(o)in t[0]){c=i[n];break}}return c}function u(){return l||(l=r(s()+"Hidden")),l}function a(){return d||(d=r(s()+"VisibilityState")),d}var c,l,d,f,g=t[0],b={hidden:!!g[u()],visibilityState:g[a()],focused:!0,pageVisibilitySupported:void 0!==g[u()],widgetPageVisibleFlag:!1,isVisible:function(){return o.isWidget()?b.widgetPageVisibleFlag:b.focused&&!b.hidden},$on:function(){var i=Array.prototype.slice.call(arguments);return i[0]="pageVisibility:"+i[0],n.$on.apply(n,i)},$emit:function(){b.widgetPageVisibleFlag=b.focused;var i=Array.prototype.slice.call(arguments);return i[0]="pageVisibility:"+i[0],n.$emit.apply(n,i)}};return e.element(i).on("blur",function(){b.focused&&(b.focused=!1,b.$emit("visibilitychange"))}),e.element(i).on("focus",function(){b.focused||(b.focused=!0,b.$emit("visibilitychange"))}),b.pageVisibilitySupported&&g.addEventListener(function(){return f||(f=s()+"visibilitychange"),f}(),function(){b.hidden=g[u()],b.visibilityState=g[a()],b.$emit("visibilitychange")}),b}])});