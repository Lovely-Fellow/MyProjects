define(["./markdown-it-plugin-dash-helpers"],function(e){"use strict";return function(n,r){function s(n,s){var t,a,i,l,u,f,h,k,d=n.pos,_=n.posMax;if(60!==n.src.charCodeAt(d))return!1;if(d+=1,-1!==p.indexOf(n.src.charAt(d)))return!1;for(i=d;d<_;){if("|"===(h=n.src.charAt(d))||">"===h){a=d;break}d++}if(!a)return!1;if(l=e.demask(n.src.slice(i,a)),n.env.escaped&&(l=e.unescape(l)),-1===l.indexOf("."))return!1;if(">"===h)f=i,u=a;else{for(d++,f=d;d<_;){if(">"===n.src.charAt(d)){u=d;break}d++}if(!u)return!1}if(d++,o.test(l)||c.test(l)||(l="http://"+l),!s){if(!(t=r.process(l)))return!1;n.env.asPlainText?k=n.push("dash_link_open","span",1):(k=n.push("dash_link_open","a",1),k.attrs=[],k.attrs.push(["href",l]),Object.keys(t).forEach(function(e){k.attrs.push([e,t[e]])})),n.pos=f,n.posMax=u,n.md.inline.tokenize(n),n.push("dash_link_close",n.env.asPlainText?"span":"a",-1)}return n.pos=d,n.posMax=_,!0}function t(n){l.test(n.src)&&(n.src=n.src.replace(l,function(n){return e.mask(n)}))}function a(n){var r,s,t=!1;for(r=n.length-1;r>=0;r--)s=n[r],"text"===s.type&&t&&(s.content=e.demask(s.content)),"dash_link_close"===s.type&&(t=!0),"dash_link_open"===s.type&&(t=!1)}function i(e){var n;for(n=e.tokens.length-1;n>=0;n--)"inline"===e.tokens[n].type&&a(e.tokens[n].children)}var o=/^mailto:|:\/\//i,c=/^https?:\/\//i,p=["#","%","@"];n.inline.ruler.before("autolink","dash_link",s);var l=new RegExp("(<[^@%#][^|]+\\|)([^>]*?["+e.maskableOperators.join("")+"]+[^>]*)?(>)","gm");n.core.ruler.before("normalize","dash_link_mask",t),n.core.ruler.push("dash_link_demask",i)}});