define([],function(){"use strict";return function(t,e){var n=t.validateLink;t.validateLink=function(t){return n.call(this,t)&&!!e.process(t)};var r=t.renderer.rules.link_open||function(t,e,n,r,a){return a.renderToken(t,e,n)};t.renderer.rules.link_open=function(t,n,a,i,s){if(t[n].attrs&&t[n].attrs[0]&&"href"===t[n].attrs[0][0]){"text"===t[n+1].type&&t[n+1].content&&(t[n+1].content=decodeURIComponent(t[n+1].content));var o=t[n].attrs[0][1];/^mailto:|:\/\//i.test(o)||(o="http://"+o);var c=e.process(o);return!1!==c?(t[n].attrs[0][1]=o,Object.keys(c).forEach(function(e){t[n].attrPush([e,c[e]])})):t[n].attrs[0][1]="",r.call(this,t,n,a,i,s)}return r.call(this,t,n,a,i,s)}}});