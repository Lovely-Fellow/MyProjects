define(["./common","angular","./retry-dialog-service","./retry-service"],function(t,e){"use strict";t.factory("eoRetryWorkflow",["$q","$rootScope","eoRetryDialog","eoRetry","eoModelRegistry",function(t,r,i,n,o){var a=o.get("Base"),c={scale:500,maxWait:1e4,maxAttempts:10},s=r.$new(),l=a.extend({try:function(){var e=this;return this._retriableActionPromise||(this._retriableAction=n.create(this._actionToTry,this._retryOptions),this._retriableActionPromise=this._retriableAction.try(),this._retriableActionPromise.then(function(t){return e._retryModal&&(e._retryModal.dismiss("success"),e._retryModal=null),t},function(r){return e._retryModal&&(e._retryModal.dismiss("final rejection"),e._retryModal=null),t.reject(r)},function(t){s.retryDetails=t,e._retryModal||"ATTEMPT_PRIMED"!==t.type||(e._retryModal=i.open(s))})),this._retriableActionPromise},attempt:function(){return this._retriableAction.attempt()},init:function(t,r){this._actionToTry=t,this._retryOptions=e.extend({},c,r||{})},cancel:function(t){return this._retriableAction.cancel(t)}});return{create:function(t,e){return new l(t,e)}}}])});