define(["./common","angular","lodash"],function(e,n,t){"use strict";e.directive("eoPanelOpener",["$timeout","$modal","$modalStack","$window",function(e,o,i,l){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,s,c){var a,f;this.options=r.$eval(c.eoPanelOpener)||{},this.handleClick=function(r,s,c){r.preventDefault();var d=r.currentTarget,p=n.element(d),u=n.extend({},this.options,s),m=u.config(c),h=p.offset(),$=p.width(),g=p.height();m&&(n.isUndefined(m.windowClass)&&(m.windowClass=""),m.windowClass+=" panel-opener-modal",n.isUndefined(m.backdropClass)&&(m.backdropClass="transparent-backdrop"),a=o.open(m),a.rendered.then(function(){var o=i.getTop().value.modalDomEl,r=o.find(".modal-content"),s=function(){!m.placement&&l.innerWidth<h.left+r.outerWidth()&&(m.placement="left"),"left"!==m.placement&&"top-left"!==m.placement||(h.left-=r.outerWidth()-$-(m.leftOffset||0)),"top"!==m.placement&&"top-left"!==m.placement||(h.top-=r.outerHeight()-g-(m.topOffset||0)),h.top+r.prop("scrollHeight")>l.innerHeight&&(h.top=l.innerHeight-r.prop("scrollHeight")-10)};s(),r.show().css(h),f=t.throttle(function(){e(function(){p=n.element(d),h=p.offset(),r=o.find(".modal-content"),s(),r.css(h)},250)},250),n.element(l).on("resize",f)}),a.result&&(a.result.then(function(){n.element(l).off("resize",f),u.onClose&&u.onClose.call()}),a.result.catch(function(){n.element(l).off("resize",f),u.onDismiss&&u.onDismiss.call()})))}}]}}]).directive("eoPanelOpen",function(){return{restrict:"A",require:"^eoPanelOpener",link:function(e,n,t,o){var i=e.$eval(t.eoPanelOpen)||{},l=function(n){return o.handleClick(n,i,e)};n.bind("click",l),e.$on("$destroy",function(){n.unbind("click",l)})}}})});